<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Sessions - Topic Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div id="nav-container"></div>

  <main class="page-content">
    <h1>My Sessions</h1>
    <p>View your past classification sessions.</p>

    <div id="sessions-list" class="sessions-list">
      <div class="loading">Loading sessions...</div>
    </div>
  </main>

  <script type="module">
    import { renderNav } from "/static/shared/nav.js";
    import { getUserSessions } from "/static/shared/api.js";

    // Initialize navigation
    renderNav("nav-container");

    const sessionsList = document.getElementById("sessions-list");

    // Load sessions on page load
    loadSessions();

    async function loadSessions() {
      try {
        const sessions = await getUserSessions();

        if (sessions.length === 0) {
          sessionsList.innerHTML = `
            <div class="empty-state">
              <p>No sessions yet.</p>
              <p><a href="/classify">Classify some questions</a> to get started!</p>
            </div>
          `;
          return;
        }

        sessionsList.innerHTML = sessions
          .map((session) => {
            const date = new Date(session.created_at).toLocaleDateString("en-GB", {
              day: "numeric",
              month: "short",
              year: "numeric",
              hour: "2-digit",
              minute: "2-digit",
            });

            // Build title from qualification and subject name
            const titleParts = [session.qualification, session.subject_name].filter(Boolean);
            const title = titleParts.length > 0 ? titleParts.join(" ") : session.subject;

            return `
              <a href="/session-view/${session.session_id}" class="session-card">
                <div class="session-info">
                  <div class="session-subject">${title}</div>
                  <div class="session-meta">
                    <span class="session-board">${session.exam_board}</span>
                    <span class="session-date">${date}</span>
                  </div>
                </div>
                <div class="session-questions">
                  ${session.question_count} question${session.question_count !== 1 ? "s" : ""}
                </div>
              </a>
            `;
          })
          .join("");
      } catch (error) {
        console.error("Error loading sessions:", error);
        sessionsList.innerHTML = `
          <div class="error-state">
            <p>Failed to load sessions. Please try again.</p>
          </div>
        `;
      }
    }
  </script>
</body>
</html>
